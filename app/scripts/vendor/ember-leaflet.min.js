// ==========================================================================
// Project:   Ember Leaflet
// Copyright: Â©2013 Gabe Smedresman and contributors.
// License:   Licensed under MIT license (see license.js)
// ==========================================================================



// Last commit: b62eb29 (2013-07-30 20:50:28 -0700)


(function(){EmberLeaflet=Ember.Namespace.create()})(),function(){function e(e){return e?[e.lat,e.lng]:null}function t(e){return e?[e.lng,e.lat]:null}function r(e){return e?e.lat?e:L.latLng(e[0],e[1]):null}function i(e){return e?e.lat?e:L.latLng(e[1],e[0]):null}var n=Ember.get,a=Ember.set;EmberLeaflet.convert={latLngArrayFromLatLng:e,lngLatArrayFromLatLng:t,latLngFromLatLngArray:r,latLngFromLngLatArray:i},EmberLeaflet.computed={},EmberLeaflet.computed.latLngFromLngLatArray=function(e){return Ember.computed(e,function(r,o){return 1===arguments.length?i(n(this,e)):(a(this,e,t(o)),o)})},EmberLeaflet.computed.latLngFromLatLngArray=function(t){return Ember.computed(t,function(i,o){return 1===arguments.length?r(n(this,t)):(a(this,t,o=e(o)),o)})}}(),function(){Ember.String.fmt,EmberLeaflet.LayerMixin=Ember.Mixin.create({_layer:null,_parentLayer:null,isVirtual:!1,_childLayers:[],parentLayer:Ember.computed.alias("_parentLayer").readOnly(),layer:Ember.computed(function(){return this._layer}).property(),_newLayer:Ember.required(Function),willCreateLayer:Ember.K,didCreateLayer:Ember.K,willDestroyLayer:Ember.K,didDestroyLayer:Ember.K,_createLayer:function(){Ember.assert("Parent layer must be in leaflet.",!!this._parentLayer._layer),this.willCreateLayer(),this.isVirtual||(this.propertyWillChange("layer"),this._layer=this._newLayer(),this._parentLayer._layer.addLayer(this._layer),this.propertyDidChange("layer")),this.didCreateLayer()},_destroyLayer:function(){if(this.willDestroyLayer(),!this.isVirtual){this.propertyWillChange("layer");try{this._parentLayer._layer.removeLayer(this._layer)}catch(e){Ember.Logger.warn("Error removing layer on "+this.constructor)}this._layer=null,this.propertyDidChange("layer")}this.didDestroyLayer()}}),EmberLeaflet.Layer=Ember.Object.extend(EmberLeaflet.LayerMixin,{}),EmberLeaflet.EmptyLayer=EmberLeaflet.Layer.extend({_newLayer:function(){return L.layerGroup([])}})}(),function(){var e=Ember.get,t=(Ember.set,Ember.String.fmt),r=Ember.EnumerableUtils.forEach,i=Ember.EnumerableUtils.map;EmberLeaflet.ContainerLayerMixin=Ember.Mixin.create(EmberLeaflet.LayerMixin,Ember.MutableArray,{_childLayers:null,didCreateLayer:function(){this._super(),this.createAndAddChildLayers()},willDestroyLayer:function(){this.removeAndDestroyChildLayers(),this._super()},createAndAddChildLayers:function(){void 0===this._childLayerClasses&&(this._childLayerClasses=e(this,"childLayers")||[]),Ember.defineProperty(this,"childLayers",Ember.computed(function(){return this._childLayers}).property());var t,i=this._childLayers=Ember.A(),n=this;r(this._childLayerClasses,function(e,r){t=n.createChildLayer(e),n.addChildLayer(t),i[r]=t},this)},replace:function(t,r,n){var a=n?e(n,"length"):0,o=this;if(this.arrayContentWillChange(t,r,a),this.childLayersWillChange(this._childLayers,t,r),0===a)this._childLayers.splice(t,r);else{n=i(n,function(e){return o.createChildLayer(e)});var s=[t,r].concat(n);n.length&&!this._childLayers.length&&(this._childLayers=this._childLayers.slice()),this._childLayers.splice.apply(this._childLayers,s)}return this.arrayContentDidChange(t,r,a),this.childLayersDidChange(this._childLayers,t,r,a),this},objectAt:function(e){return this._childLayers[e]},length:Ember.computed(function(){return this._childLayers.length}),childLayersWillChange:function(e,t,i){var n=this;if(this.propertyWillChange("childLayers"),i>0){var a=e.slice(t,t+i);r(a,function(e){n.removeChildLayer(e)})}},childLayersDidChange:function(e,t,i,n){var a=this;if(n>0){var o=e.slice(t,t+n);r(o,function(e){a.addChildLayer(e)})}this.propertyDidChange("childLayers")},addChildLayer:function(e){e._createLayer()},removeChildLayer:function(e){e._destroyLayer()},createChildLayer:function(e,r){r=r||{},r.controller=this.get("controller"),r._parentLayer=this.isVirtual?this._parentLayer:this;var i,n=Ember.typeOf(e);return Ember.assert(t("layerClass %@ must be an Ember instance or class.",e?e.toString():"<undefined>"),"instance"===n||"class"===n),"instance"===n?(i=e,i.setProperties(r)):"class"===n&&(i=e.create(r)),i},removeAndDestroyChildLayers:function(){var e=this;r(this._childLayers,function(t){e.removeChildLayer(t),t.destroy()}),this._childLayers=[]}}),EmberLeaflet.ContainerLayer=Ember.Object.extend(EmberLeaflet.ContainerLayerMixin,{})}(),function(){var e=L.latLng(40.713282,-74.006978);EmberLeaflet.MapView=Ember.View.extend(EmberLeaflet.ContainerLayerMixin,{options:{},center:e,zoom:16,isMoving:!1,isZooming:!1,init:function(){this._super(),void 0===this.get("childLayers")&&this.set("childLayers",[EmberLeaflet.DefaultTileLayer])},didInsertElement:function(){this._super(),this._createLayer()},willDestroyElement:function(){this._destroyLayer()},_createLayer:function(){this._layer||(Ember.assert("Center must be set before creating map, was "+this.get("center"),!!this.get("center")),Ember.assert("Zoom must be set before creating map, was "+this.get("zoom"),!!this.get("zoom")),this.willCreateLayer(),this.propertyWillChange("layer"),this._layer=L.map(this.get("elementId"),this.get("options")),this._layer.setView(this.get("center"),this.get("zoom")),this._addEventListeners(),this.propertyDidChange("layer"),this.didCreateLayer())},_destroyLayer:function(){this.willDestroyLayer(),this.propertyWillChange("layer"),this._layer&&(this._defaultChildLayer&&(this._layer.removeLayer(this._defaultChildLayer),this._defaultChildLayer=null),this._removeEventListeners(),this._layer.remove(),this._layer=null,this.propertyDidChange("layer"),this.didDestroyLayer())},_addEventListeners:function(){this._layer.on("zoomstart",this._onZoomStart,this),this._layer.on("zoomend",this._onZoomEnd,this),this._layer.on("movestart",this._onMoveStart,this),this._layer.on("moveend",this._onMoveEnd,this),this._layer.on("move",this._onMove,this)},_removeEventListeners:function(){this._layer.off("zoomstart",this._onZoomStart,this),this._layer.off("zoomend",this._onZoomEnd,this),this._layer.off("movestart",this._onMoveStart,this),this._layer.off("moveend",this._onMoveEnd,this),this._layer.off("move",this._onMove,this)},_onZoomStart:function(){this.set("isZooming",!0)},_onZoomEnd:function(){this.setProperties({isZooming:!1,zoom:this._layer.getZoom()})},_onMoveStart:function(){this.set("isMoving",!0)},_onMoveEnd:function(){this.set("isMoving",!1)},_onMove:function(){this.set("center",this._layer.getCenter())},zoomDidChange:Ember.observer(function(){this._layer&&this._layer.setZoom(this.get("zoom"))},"zoom"),centerDidChange:Ember.observer(function(){this._layer&&!this.get("isMoving")&&this._layer.panTo(this.get("center"))},"center")})}(),function(){var e=Ember.get;EmberLeaflet.TileLayer=EmberLeaflet.Layer.extend({tileUrl:null,options:{},_newLayer:function(){return L.tileLayer(e(this,"tileUrl"),e(this,"options"))}}),EmberLeaflet.DefaultTileLayer=EmberLeaflet.TileLayer.extend({tileUrl:"http://a.tiles.mapbox.com/v3/examples.map-zr0njcqy/{z}/{x}/{y}.png"})}(),function(){var e=Ember.get;Ember.EnumerableUtils.forEach,EmberLeaflet.CollectionLayer=EmberLeaflet.ContainerLayer.extend({content:[],isVirtual:!0,itemLayerClass:Ember.computed(function(){throw new Error("itemLayerClass must be defined.")}).property(),didCreateLayer:function(){this._childLayers=Ember.A(),this._contentDidChange();var t=e(this,"content");t&&t.addArrayObserver(this)},willDestroyLayer:function(){var t=e(this,"content");t&&t.removeArrayObserver(this),this._contentWillChange()},_contentWillChange:Ember.beforeObserver(function(){var t=e(this,"content");t&&t.removeArrayObserver(this);var r=t?e(t,"length"):0;this.arrayWillChange(t,0,r)},"content"),_contentDidChange:Ember.observer(function(){var t=e(this,"content");t&&t.addArrayObserver(this);var r=t?e(t,"length"):0;this.arrayDidChange(t,0,null,r)},"content"),arrayWillChange:function(e,t,r){for(var i=t;t+r>i;i++)this.objectWasRemoved(e.objectAt(i))},arrayDidChange:function(e,t,r,i){for(var n=t;t+i>n;n++)this.objectWasAdded(e.objectAt(n),n)},objectWasAdded:function(t,r){void 0===r&&(r=this._childLayers.length);var i=this.createChildLayer(e(this,"itemLayerClass"),{content:t});this.replace(r,0,[i])},objectWasRemoved:function(e){for(var t,r=0,i=this._childLayers.length;i>r;r++)if(t=this._childLayers[r],t.get("content")===e)return this.replace(r,1,[]),t.destroy(),void 0}})}(),function(){var e=Ember.get;EmberLeaflet.HashLayer=EmberLeaflet.CollectionLayer.extend({hashByProperty:"location",hashIsLocation:!0,_compareLocations:function(e,t){return e&&t?e.lat.toFixed(6)!==t.lat.toFixed(6)?!1:e.lng.toFixed(6)!==t.lng.toFixed(6)?!1:!0:!1},_getChildLayerIndexByObject:function(t){for(var r=e(this,"hashByProperty"),i=e(this,"hashIsLocation"),n=0,a=this._childLayers.length;a>n;n++){var o=e(this._childLayers[n],r),s=e(t,r);if(i){if(this._compareLocations(o,s))return n}else if(o===s)return n}return-1},_getChildLayerByObject:function(e){var t=this._getChildLayerIndexByObject(e);return-1===t?null:this._childLayers[t]},objectWasAdded:function(t){var r,i=this._getChildLayerByObject(t),n=e(this,"itemLayerClass"),a=e(this,"hashByProperty"),o=e(t,a);i?e(i,"content").addObject(t):(r={content:Ember.A([t])},r[a]=o,i=this._createChildLayer(n,r),this._childLayers.push(i))},objectWasRemvoed:function(t){for(var r,i=0,n=this._childLayers.length;n>i;i++)if(r=this._childLayers[i],-1!==e(r,"content").indexOf(t)&&e(r,"content").removeObject(t),0===e(r,"content.length"))return r._destroyLayer(),r.destroy(),this._childLayers.splice(i,1),void 0}})}(),function(){var e=Ember.get,t=Ember.set,r=Ember.setProperties;EmberLeaflet.DraggableMixin=Ember.Mixin.create({isDragging:!1,isDraggable:!0,_onDragStart:function(){t(this,"isDragging",!0)},_onDragEnd:function(){r(this,{location:this._layer.getLatLng(),isDragging:!1})},_updateDraggability:Ember.observer(function(){this._layer&&this._layer._map&&(e(this,"isDraggable")?this._layer.dragging.enable():this._layer.dragging.disable())},"isDraggable","layer"),_removeDraggableObservers:Ember.beforeObserver(function(){this._layer&&(this._layer.off("dragstart",this._onDragStart,this),this._layer.off("dragend",this._onDragEnd,this))},"layer"),_addDraggableObservers:Ember.observer(function(){this._layer&&(this._layer.on("dragstart",this._onDragStart,this),this._layer.on("dragend",this._onDragEnd,this))},"layer")})}(),function(){Ember.get,Ember.set,Ember.setProperties,EmberLeaflet.PopupMixin=Ember.Mixin.create({popupContent:"default popup content",popupOptions:{offset:L.point(0,-36)},_onClickOpenPopup:function(){this.openPopup()},_onDragStartClosePopup:function(){this.closePopup()},openPopup:function(){this.willOpenPopup(),this._popup.setLatLng(this._layer.getLatLng()).setContent(this.get("popupContent")).openOn(this._layer._map),this.didOpenPopup()},closePopup:function(){this.willClosePopup(),this._layer._map.closePopup(),this.didClosePopup()},willOpenPopup:Ember.K,didOpenPopup:Ember.K,willClosePopup:Ember.K,didClosePopup:Ember.K,willCreatePopup:Ember.K,didCreatePopup:Ember.K,willDestroyPopup:Ember.K,didDestroyPopup:Ember.K,_createPopup:function(){this.willCreatePopup(),this._popup=L.popup(this.get("popupOptions")),this.didCreatePopup()},_destroyPopup:function(){this._popup&&(this.willDestroyPopup(),this._popup._map&&this._layer&&this._layer._map&&this._layer._map.closePopup(),this._popup=null,this.didDestroyPopup())},_removePopupObservers:Ember.beforeObserver(function(){this._layer&&(this._layer.off("click",this._onClickOpenPopup,this),this._layer.off("dragstart",this._onDragStartClosePopup,this),this._destroyPopup())},"layer"),_addPopupObservers:Ember.observer(function(){this._layer&&(this._createPopup(),this._layer.on("click",this._onClickOpenPopup,this),this._layer.on("dragstart",this._onDragStartClosePopup,this))},"layer")})}(),function(){var e=Ember.get;EmberLeaflet.MarkerLayer=EmberLeaflet.Layer.extend({content:null,options:null,location:Ember.computed.alias("content.location"),_updateLayerOnLocationChange:Ember.observer(function(){var t=e(this,"location");if(t&&!this._layer)this._createLayer();else if(this._layer&&!t)this._destroyLayer();else{var r=this._layer&&this._layer.getLatLng();r&&t&&!r.equals(t)&&this._layer.setLatLng(t)}},"location"),_newLayer:function(){return L.marker(e(this,"location"),e(this,"options"))},_createLayer:function(){if(!this._layer&&e(this,"location")){this._super(),this._layer.content=e(this,"content");var t=this._layer.onAdd,r=this;this._layer.onAdd=function(){r.propertyWillChange("layer"),t.apply(this,arguments),r.propertyDidChange("layer")},this.notifyPropertyChange("layer")}},_destroyLayer:function(){this._layer&&this._super()}})}(),function(){var e=Ember.get,t=Ember.EnumerableUtils.forEach;EmberLeaflet.BoundsMixin=Ember.Mixin.create({bounds:Ember.computed(function(){var r,i=[];return t(this,function(t){(r=e(t,"location"))&&i.push(r)}),Ember.isEmpty(i)?null:new L.LatLngBounds(i)}).property("@each.location")})}(),function(){EmberLeaflet.MarkerCollectionLayer=EmberLeaflet.CollectionLayer.extend(EmberLeaflet.BoundsMixin,{itemLayerClass:EmberLeaflet.MarkerLayer})}(),function(){Ember.get,Ember.EnumerableUtils.forEach,EmberLeaflet.MarkerHashLayer=EmberLeaflet.HashLayer.extend(EmberLeaflet.BoundsMixin,{itemLayerClass:EmberLeaflet.MarkerLayer,hashByProperty:"location",hashIsLocation:!0})}(),function(){var e=Ember.get;EmberLeaflet.ArrayGeometryLayer=EmberLeaflet.Layer.extend({init:function(){this._super(),this._contentDidChange()},destroy:function(){if(this._super()){var t=e(this,"content");return t&&t.removeArrayObserver(this),this}},_contentWillChange:Ember.beforeObserver(function(){var t=e(this,"content");t&&t.removeArrayObserver(this)},"content"),_contentDidChange:Ember.observer(function(){var t=e(this,"content");t&&t.addArrayObserver(this)},"content")})}(),function(){var e=Ember.get;EmberLeaflet.PolylineLayer=EmberLeaflet.ArrayGeometryLayer.extend({options:{},locationProperty:null,locations:Ember.computed(function(){var t=e(this,"content")||[];return e(this,"locationProperty")&&(t=t.mapProperty(e(this,"locationProperty"))),t=t.filter(function(e){return!!e})}).property("content","locationProperty").volatile(),_newLayer:function(){return L.polyline(e(this,"locations"),e(this,"options"))},locationsDidChange:Ember.observer(function(){this._layer&&this._layer.setLatLngs(e(this,"locations"))},"locations"),arrayWillChange:function(){this.propertyWillChange("locations")},arrayDidChange:function(){this.propertyDidChange("locations")}}),EmberLeaflet.PolygonLayer=EmberLeaflet.PolylineLayer.extend({_newLayer:function(){return L.polygon(e(this,"locations"),e(this,"options"))}})}(),"undefined"==typeof location||"localhost"!==location.hostname&&"127.0.0.1"!==location.hostname||console.warn("You are running a production build of Ember on localhost and won't receive detailed error messages. If you want full error messages please use the non-minified build provided on the Ember website.");
